<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>YouTube Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 700px;
            margin-top: 60px;
        }
        .results-table {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">YouTube Downloader</h2>

        <form id="ytForm">
            <div class="mb-3">
                <label for="ytUrl" class="form-label">YouTube URL</label>
                <input type="url" class="form-control" id="ytUrl" placeholder="Enter YouTube link" required>
            </div>

            <div class="mb-3">
                <label class="form-label">Select Download Type</label><br>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="audio" value="audio">
                    <label class="form-check-label" for="audio">Audio</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" id="video" value="video">
                    <label class="form-check-label" for="video">Video</label>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Start Download</button>
            <a href="/" class="btn btn-outline-dark">Back to Dashboard</a>
        </form>

        <div id="result" class="results-table d-none">
            <h4 class="mt-4">Download Links</h4>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th>File</th>
                    </tr>
                </thead>
                <tbody id="resultBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        document.getElementById('ytForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const url = document.getElementById('ytUrl').value.trim();
            const audioChecked = document.getElementById('audio').checked;
            const videoChecked = document.getElementById('video').checked;

            if (!url || (!audioChecked && !videoChecked)) {
                alert("Please enter a URL and select at least one download option.");
                return;
            }

            let mode = '';
            if (audioChecked && videoChecked) {
                mode = 'both';
            } else if (audioChecked) {
                mode = 'audio';
            } else if (videoChecked) {
                mode = 'video';
            }

            fetch('/download_youtube', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url, mode })
            })
            .then(res => res.json())
            .then(data => {
                if (data.files) {
                    const tbody = document.getElementById('resultBody');
                    tbody.innerHTML = '';

                    data.files.forEach(link => {
                        const type = link.includes('_audio') || link.endsWith('.mp3') ? 'Audio' : 'Video';
                        const row = `<tr><td>${type}</td><td><a href="${link}" target="_blank">${link}</a></td></tr>`;
                        tbody.insertAdjacentHTML('beforeend', row);
                    });

                    document.getElementById('result').classList.remove('d-none');
                } else {
                    alert("Failed to start download. Try again.");
                }
            })
            .catch(err => {
                alert("Error: " + err.message);
            });
        });
    </script>
</body>
</html>
